<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pianificazione Viaggio</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="wrap">
    <div style="display:flex; flex-wrap:wrap; gap:12px; align-items:baseline; justify-content:space-between;">
      <div>
        <h1>Pianificazione viaggio</h1>
        <div class="meta" id="sourceMeta">Fonte: Google Sheets (CSV pubblicato)</div>
      </div>
      <div style="display:flex; gap:8px; align-items:center;">
        <button class="smallBtn" id="btnReload">Ricarica</button>
        <button class="smallBtn" id="btnClearGeo">Svuota cache mappa</button>
      </div>
    </div>

    <div class="controls">
      <input id="q" type="text" placeholder="Cerca (città, hotel, note...)" style="min-width:260px;"/>
      <select id="type">
        <option value="">Tutte</option>
        <option value="Trip">Trip</option>
        <option value="Notte">Notte</option>
      </select>
      <select id="city"><option value="">Tutte le città</option></select>
      <select id="status"><option value="">Tutti gli stati</option></select>
    </div>

    <div class="kpis">
      <div class="kpi"><div class="v" id="kDays">—</div><div class="l">giorni</div></div>
      <div class="kpi"><div class="v" id="kTrips">—</div><div class="l">tratte (Trip)</div></div>
      <div class="kpi"><div class="v" id="kNights">—</div><div class="l">notti</div></div>
      <div class="kpi"><div class="v" id="kKm">—</div><div class="l">km totali</div></div>
      <div class="kpi"><div class="v" id="kCost">—</div><div class="l">costo totale</div></div>
    </div>

    <div class="tabs">
      <div class="tab active" data-tab="timeline">Timeline</div>
      <div class="tab" data-tab="map">Mappa</div>
      <div class="tab" data-tab="bookings">Prenotazioni</div>
    </div>

    <div id="view-timeline">
      <div class="grid">
        <div class="panel">
          <div class="hd">
            <h2>Giorno per giorno</h2>
            <div class="meta" id="metaCount">—</div>
          </div>
          <div class="bd" id="timeline"></div>
        </div>

        <div class="panel">
          <div class="hd">
            <h2>Riepilogo città</h2>
            <div class="meta">notti + tratte</div>
          </div>
          <div class="bd" id="citySummary"></div>
        </div>
      </div>
    </div>

    <div id="view-map" class="hidden">
      <div class="panel">
        <div class="hd">
          <h2>Mappa (OpenStreetMap)</h2>
          <div class="mapModes">
            <button class="modeBtn active" data-mode="route">Rotta</button>
            <button class="modeBtn" data-mode="night">Pernottamenti</button>
          </div>
          <div class="meta" id="mapMeta">—</div>
        </div>
        <div class="bd">
          <div id="map"></div>
          <div class="meta" style="margin-top:10px;">
            Rotta usa le colonne <code>Partenza</code>, <code>Arrivo</code> e <code>Luogo</code>.
            Pernottamenti usa la colonna <code>Indirizzo</code> nelle righe di tipo <code>Notte</code>.
          </div>
        </div>
      </div>
    </div>

    <div id="view-bookings" class="hidden">
      <div class="panel">
        <div class="hd">
          <h2>Prenotazioni (solo Notti)</h2>
          <div class="meta">hotel · link · stato · costo</div>
        </div>
        <div class="bd" id="bookings"></div>
      </div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
